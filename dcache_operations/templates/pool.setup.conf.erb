<?xml version="1.0"?>
<pools>
<% @pool_layout_hash.sort.each do |pool_name,pool_info| -%>
<pool>
<name><%= pool_name %></name>
<location><%= pool_info['MOUNTPOINT'] -%></location>
<body>#########################################################################################################
##
## DO NOT EDIT
## generated by puppet module :<%= @name %>
## and using python /root/distribute_setups.py 
## based on /etc/dcache/all.pools.setup.xml
##
## node :<%= @fqdn %>
##
###############################################################################################################
csm set checksumtype ADLER32
<% if @do_scrub-%>
csm set policy -scrub=on -limit=off -period=<%= @scrub_intervall %>
<% else %>
csm set policy -scrub=off
<% end -%>
csm set policy -onread=off -onwrite=off -onflush=off -onrestore=on -enforcecrc=on -getcrcfromhsm=off
###############################################################################################################
# Flushing Thread setup
#
flush set max active 1000
flush set interval 60
flush set retry delay 60
###############################################################################################################
# Nearline storage
#
hsm create osm osm script -crc=on -command=/usr/share/dcache/lib/osm-hsmcp.py -c:gets=10 -c:puts=2 -c:removes=0
hsm create object object script -c:gets=20 -c:puts=10 -command=/usr/share/dcache/lib/obj-hsmcp.py -c:removes=1
###############################################################################################################
# Mover queues
mover queue create regular -order=LIFO
mover queue create p2p -order=LIFO
mover queue create dcap-q -order=LIFO
mover queue create ftp-q -order=LIFO
mover queue create nfs-q -order=LIFO
mover queue create default -order=LIFO
mover queue create io -order=LIFO
mover set max active -queue=regular 1000
mover set max active -queue=p2p 10
mover set max active -queue=dcap-q 200
mover set max active -queue=ftp-q 10
mover set max active -queue=nfs-q 1000
mover set max active -queue=default 2
mover set max active -queue=io 2
jtm set timeout -queue=regular -lastAccess=0 -total=0
jtm set timeout -queue=p2p -lastAccess=10800 -total=10800
jtm set timeout -queue=dcap-q -lastAccess=172800 -total=0
jtm set timeout -queue=ftp-q -lastAccess=0 -total=0
jtm set timeout -queue=nfs-q -lastAccess=0 -total=0
jtm set timeout -queue=default -lastAccess=0 -total=0
jtm set timeout -queue=io -lastAccess=0 -total=0
###############################################################################################################
# MigrationModule
#
set heartbeat 30
set report remove on
set breakeven <%= @breackeven_factor %>
set mover cost factor <%= @cost_factor %>
set duplicate request none
###############################################################################################################
#  Pool to Pool (P2P)
#
queue define class object * -pending=60 -total=20000000000 -expire=7200 -open=false
queue define class osm * -pending=100 -total=200000000000 -expire=7200 -open=false
<% dev_size = pool_info['SIZE'].to_i -%>
<% gap_size = @pool_gap.to_i -%>
<% diskspace = dev_size - gap_size -%>
set max diskspace <%= diskspace %>
set gap <%= gap_size %>
rh set timeout <%= @rh_timeout %>
st set timeout <%= @st_timeout %>
rm set timeout <%= @rm_timeout %>
</body>
</pool>
<% end -%>
</pools>
